angular.module("Dragtable",[]).directive("dragMe",[function(){return{link:function(e,t,n){t.attr("draggable",!0),n.handle&&t.find(n.handle)?t.find(n.handle).attr("style","cursor: e-resize;"):t.attr("style","cursor: e-resize;");var r=n.limit||50,i=0,o=!1,a=!1,l=!1,d='<div class="ghost" style="position: fixed;">{ghostHtml}</div>',s='<div class="{elemClass}" style="height: {height}px; width: {width}px;">{text}</div>',f=function(e,t){for(var n in t)e=e.replace(new RegExp("{"+n+"}","g"),t[n]);return e},h=function(e){i=e.originalEvent.clientX-t.offset().left},g=function(e){l&&l.remove(),h(e),c(u())},u=function(){var e="",n=t.index()+1,i=t.closest("table").find("tr td:nth-child("+n+"):visible");i.addClass("ghost__data");var o=i.length;o>r&&(o=r);for(var a=0;a<o;a++){var l=$(i[a]);e+=f(s,{elemClass:"ghost__td",height:l.outerHeight(),width:l.outerWidth(),text:l.html()})}return e},c=function(e){t.closest("table").before(f(d,{ghostHtml:e})),l=$(".ghost");var n=t.offset();l.css("top",n.top-$(window).scrollTop()+t.outerHeight()),l.css("left",n.left)},v=function(){angular.element(".ghost__placeholder").removeClass("ghost__placeholder").removeAttr("width"),angular.element(".ghost__data").removeClass("ghost__data")};t.bind("mousedown",function(e){a=e.target}),t.bind("dragstart",function(e){return!(n.handle&&!$(a).hasClass(n.handle)&&!$(a).closest(n.handle).length)&&(v(),t.addClass("ghost__placeholder").attr("width",t.outerWidth()),void g(e))}),t.bind("drag",function(e){clearTimeout(o),o=setTimeout(function(){l&&l.css("left",e.originalEvent.clientX-i)},5)}),t.bind("dragstop dragend",function(e){l&&l.remove(),v(),a=!1})}}}]).directive("dropMe",[function(){return{link:function(e,t,n){var r=!1,i=function(e,n){var r=angular.element(".ghost__placeholder").last(),i=angular.element("tbody td:nth-child("+n+")"),o=angular.element(".ghost__data"),a=i.length;if("right"===e){t.after(r);for(var l=0;l<a&&"undefined"!=typeof o[l];l++)i[l].after(o[l])}else if("left"===e){t.before(r);for(var d=0;d<a&&"undefined"!=typeof o[d];d++)i[d].before(o[d])}};t.bind("dragover",function(e){e.preventDefault(),clearTimeout(r),r=setTimeout(function(){var n=e.originalEvent.x>t.offset().left+t.width()/2?"right":"left";i(n,t.index()+1)},5)})}}}]);