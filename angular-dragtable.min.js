angular.module("Dragtable",[]).directive("dragMe",[function(){return{link:function(t,e,n){e.attr("draggable",!0).attr("style","cursor: e-resize;");var o=n.limit||50,r=0,i=!1,a=!1,l=!1,s='<div class="ghost" style="position: fixed;">{ghostHtml}</div>',d='<div class="{elemClass}" style="height: {height}px; width: {width}px;">{text}</div>',f=function(t,e){for(var n in e)t=t.replace(new RegExp("{"+n+"}","g"),e[n]);return t},h=function(t){r=t.originalEvent.clientX-e.offset().left},g=function(t){l&&l.remove(),h(t),c(u())},u=function(){var t="",n=e.index()+1,r=e.closest("table").find("tr td:nth-child("+n+"):visible");r.addClass("ghost__data");var i=r.length;i>o&&(i=o);for(var a=0;a<i;a++){var l=$(r[a]);t+=f(d,{elemClass:"ghost__td",height:l.outerHeight(),width:l.outerWidth(),text:l.html()})}return t},c=function(t){e.closest("table").before(f(s,{ghostHtml:t})),l=$(".ghost");var n=e.offset();l.css("top",n.top-$(window).scrollTop()+e.outerHeight()),l.css("left",n.left)},v=function(){angular.element(".ghost__placeholder").removeClass("ghost__placeholder").removeAttr("width"),angular.element(".ghost__data").removeClass("ghost__data")};e.bind("mousedown",function(t){a=t.target}),e.bind("dragstart",function(t){return!(n.handle&&!$(a).hasClass(n.handle)&&!$(a).closest(n.handle).length)&&(v(),e.addClass("ghost__placeholder").attr("width",e.outerWidth()),void g(t))}),e.bind("drag",function(t){clearTimeout(i),i=setTimeout(function(){l&&l.css("left",t.originalEvent.clientX-r)},5)}),e.bind("dragstop dragend",function(t){l&&l.remove(),v(),a=!1})}}}]).directive("dropMe",[function(){return{link:function(t,e,n){var o=!1,r=function(t,n){var o=angular.element(".ghost__placeholder").last(),r=angular.element("tbody td:nth-child("+n+")"),i=angular.element(".ghost__data"),a=r.length;if("right"===t){e.after(o);for(var l=0;l<a&&"undefined"!=typeof i[l];l++)r[l].after(i[l])}else if("left"===t){e.before(o);for(var s=0;s<a&&"undefined"!=typeof i[s];s++)r[s].before(i[s])}};e.bind("dragover",function(t){t.preventDefault(),clearTimeout(o),o=setTimeout(function(){var n=t.originalEvent.x>e.offset().left+e.width()/2?"right":"left";r(n,e.index()+1)},5)})}}}]);